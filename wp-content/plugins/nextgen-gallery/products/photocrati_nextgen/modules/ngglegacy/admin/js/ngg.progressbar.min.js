!function(t){nggProgressBar={settings:{header:"",id:"progressbar",init:!1,maxStep:100,wait:!1,finishedNote:"Done!",submitNGGFormOnFinished:!0,includeTinyMCEHackForIncrements:!0},width:0,init:function(i){const n=this;return i=this.settings=t.extend({},this.settings,{},i||{}),this.adjust_max_step(i.maxStep),0===t("#"+i.id+"_dialog").length&&(i.header=i.header.length>0?i.header:"",t("body").append('<div id="'+i.id+'_dialog"><div id="'+i.id+'" class="progressborder"><div class="'+i.id+'"><span>0%</span></div></div></div>'),t("#"+i.id+"_dialog").dialog({width:640,resizable:!0,modal:!0,title:i.header,position:{my:"center",at:"center",of:this.find_parent(window)},close:function(t,i){n.remove_dialog(0,0)}})),this.div=t("#"+i.id+"_dialog"),i.init=!0,this.div},adjust_max_step:function(t){this.settings.maxStep=t,this.width=Math.round(100/t*100)/100},find_parent:function(t){try{t&&t.parent&&(t=t.parent)}catch(t){}return t},addMessage:function(i){const n=this.settings;n.init||this.init();const e=this.div;0===e.find("#"+n.id+"_message").length?e.append('<div class="'+n.id+'_message"><span style="display:block" id="'+n.id+'_message">'+i+"</span></div>"):t("#"+n.id+"_message").html(i)},addNote:function(i,n){const e=this.settings;e.init||this.init();const s=this.div;e.wait=!0,0===s.find("#"+e.id+"_note").length&&s.append('<ul id="'+e.id+'_note">&nbsp;</ul>'),n?t("#"+e.id+"_note").append("<li>"+i+"<div class='show_details'><span>[more]</span><br />"+n+"</div></li>"):t("#"+e.id+"_note").append("<li>"+i+"</li>"),s.dialog("option","height",220)},increase:function(i){const n=this.settings,e=i*this.width+"%",s=Math.round(i*this.width)+"%";if(t("#"+n.id+" div").width(e),t("#"+n.id+" span").html(s),n.includeTinyMCEHackForIncrements){t(this.find_parent(window).document).scrollTop(0);const o=t(this.find_parent(window).frameElement).parent(),a=o.css("top");setTimeout(function(){o.css("top",0)},1),setTimeout(function(){o.css("top",a)},3)}},finished:function(i){const n=this.settings;i=void 0===i?n.finishedNote:i,t("#"+n.id+" div").width("100%"),t("#"+n.id+" span").html("100%");const e=this.div,s=this;n.wait?(t("#"+n.id).delay(1e3).hide("slow"),s.addNote(i),e.on("click",function(){s.remove_dialog(!1,0)})):window.setTimeout(function(){s.remove_dialog(!0,1)},1e3)},remove_dialog:function(i,n){const e=t("#"+this.settings.id+"_dialog");if(i?e.delay(4e3).dialog("destroy"):e.dialog("destroy"),e.remove(),this.settings.submitNGGFormOnFinished){const s=t(".nggform");s.prepend('<input type="hidden" name="ajax_callback" value="'+n+'">'),i?s.delay(4e3).submit():s.submit()}}}}(jQuery);const nggProgressBarManager={starting_count:0,progress_bar:null,polling_status:!1,button:null,messages:{no_images_found:"No images were found to operate on",operation_finished:"Operation has completed",header:"Working..."},initialize:function(t,i,n,e){const s=this;this.messages=i,this.primary_url=n,this.secondary_url=void 0===e?n:e,this.button=document.getElementById(t),this.button.addEventListener("click",function(t){t.preventDefault(),s.button.setAttribute("disabled","true"),s.first_fetch()})},initialize_progress_bar:function(){if(this.progress_bar)return this.progress_bar;const t=this;this.progress_bar=nggProgressBar.init({header:this.messages.header,wait:!0,finishedNote:this.messages.operation_finished,submitNGGFormOnFinished:!1,includeTinyMCEHackForIncrements:!1}),this.progress_bar.on("dialogclose",function(){t.polling_status=!1,t.progress_bar=null,t.button.removeAttribute("disabled")})},first_fetch:function(){this.initialize_progress_bar();const t=this;fetch(this.primary_url,{method:"post",cache:"no-cache"}).then(function(t){return t.json()}).then(function(i){0===i.remaining?(t.button.removeAttribute("disabled"),nggProgressBar.finished(t.messages.no_images_found)):(t.polling_status=!0,t.starting_count=i.remaining,nggProgressBar.adjust_max_step(t.starting_count),t.continuing_fetch())})},continuing_fetch:function(){const t=this;fetch(this.secondary_url,{method:"post",cache:"no-cache"}).then(function(t){return t.json()}).then(function(i){const n=Math.round((t.starting_count-i.remaining)/t.starting_count*100);n<100?(nggProgressBar.increase(n),t.polling_status&&t.continuing_fetch()):(nggProgressBar.increase(100),nggProgressBar.finished(),t.button.removeAttribute("disabled"))})}};